description: >
  Call this command to send a build or deployment notification to Jira

parameters:
  branch:
    type: string
    default: << pipeline.git.branch >>
  job_type:
    type: enum
    enum:
      - build
      - deployment
    default: build

steps:
  - when:
      condition:
        or:
          - equal: [ develop, << parameters.branch >> ]
      steps:
        - notify_send:
            branch: << parameters.branch >>
            job_type: << parameters.job_type >>
            environment_type: development

  - when:
      condition:
        or:
          - equal: [ qa, << parameters.branch >> ]
      steps:
        - notify_send:
            branch: << parameters.branch >>
            job_type: << parameters.job_type >>
            environment_type: testing

  - when:
      condition:
        or:
          - equal: [ staging, << parameters.branch >> ]
      steps:
        - notify_send:
            branch: << parameters.branch >>
            job_type: << parameters.job_type >>
            environment_type: staging

  - when:
      condition:
        or:
          - equal: [ main, << parameters.branch >> ]
          - equal: [ master, << parameters.branch >> ]
      steps:
        - notify_send:
            branch: << parameters.branch >>
            job_type: << parameters.job_type >>
            environment_type: production

  - when:
      condition:
        not:
          or:
            - equal: [ develop, << parameters.branch >> ]
            - equal: [ qa, << parameters.branch >> ]
            - equal: [ staging, << parameters.branch >> ]
            - equal: [ main, << parameters.branch >> ]
            - equal: [ master, << parameters.branch >> ]
      steps:
        - notify_send:
            branch: << parameters.branch >>
            job_type: << parameters.job_type >>
            environment_type: unmapped
